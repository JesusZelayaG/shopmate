version: 2

defaults: &defaults
  docker:
    - image: circleci/node:10.14.2

jobs:
  build:
    docker:
      - image: docker:17.05.0-ce-git
    steps:
      - setup_remote_docker
      - checkout
      - run:
          name: Build Docker image
          command: |
            echo "building aaronreynoza/$CIRCLE_PROJECT_REPONAME:$CIRCLE_TAG"
            docker build -t aaronreynoza/shopmate:0.1.0 .
  test:
    <<: *defaults
    steps:
      - checkout
      - run:
          name: Install libraries
          command: | 
            cd backend && npm ci
      - run:
          name: "Run tests"
          command: |
            npm run test
  lint:
    <<: *defaults
    steps:
      - checkout
      - run:
          name: Install libraries
          command: | 
            cd backend && npm ci
      - run:
          name: "Run lint"
          command: |
            npm run lint

workflows:
  version: 2
  core:
    jobs:
      - test
      - lint
      - build:
          requires:
            - lint
            - test
